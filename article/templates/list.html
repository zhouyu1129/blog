{% extends 'base.html' %}
{% load static %}

{% block head %}
<style>
/* 文章预览样式 */
.article-preview {
    max-height: 150px;
    overflow: hidden;
    position: relative;
    line-height: 1.6;
}

.article-preview::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 30px;
    background: linear-gradient(transparent, white);
}

.article-preview h1,
.article-preview h2,
.article-preview h3,
.article-preview h4,
.article-preview h5,
.article-preview h6 {
    font-size: 1em;
    margin: 0.5em 0;
}

.article-preview p {
    margin-bottom: 0.5em;
}

.article-preview code {
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 85%;
    background-color: rgba(27,31,35,0.05);
    border-radius: 3px;
    font-family: "SFMono-Regular",Consolas,"Liberation Mono",Menlo,Courier,monospace;
}

.article-preview blockquote {
    padding: 0 1em;
    color: #6a737d;
    border-left: 0.25em solid #dfe2e5;
    margin: 0.5em 0;
}
</style>
{% endblock %}

{% block title %}文章列表 - 校园博客{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>文章列表</h2>
            {% if user.is_authenticated %}
                <a href="{% url 'article:article_create' %}" class="btn btn-primary">
                    <i class="fas fa-plus mr-1"></i> 写文章
                </a>
            {% endif %}
        </div>
        
        <!-- 搜索框 -->
        <div class="card mb-4">
            <div class="card-body">
                <form method="get" action="{% url 'article:article_list' %}">
                    <div class="input-group">
                        <input type="text" name="search" class="form-control" placeholder="搜索文章标题或内容..." value="{{ search_query }}">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="submit">
                                <i class="fas fa-search"></i> 搜索
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- 文章列表 -->
        {% if page_obj %}
            {% for article in page_obj %}
                <div class="card mb-4">
                    <div class="card-body">
                        <h2 class="card-title">
                            <a href="{% url 'article:article_detail' article.pk %}" class="text-decoration-none">{{ article.title }}</a>
                        </h2>
                        <p class="card-text text-muted">
                            作者：{% if article.author_id.nickname %}{{ article.author_id.nickname }}{% else %}{{ article.author_id.username }}{% endif %} | 
                            发布时间：{{ article.created_at|date:"Y-m-d H:i" }} | 
                            更新时间：{{ article.updated_at|date:"Y-m-d H:i" }}
                        </p>
                        <div class="card-text article-preview">
                            {{ article.content_preview|safe }}
                        </div>
                        <a href="{% url 'article:article_detail' article.pk %}" class="btn btn-primary">阅读全文</a>
                    </div>
                </div>
            {% endfor %}
            
            <!-- 分页 -->
            {% if page_obj.has_other_pages %}
                <nav aria-label="文章列表分页">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}">首页</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">上一页</a>
                            </li>
                        {% endif %}
                        
                        <li class="page-item active">
                            <span class="page-link">
                                第 {{ page_obj.number }} 页 / 共 {{ page_obj.paginator.num_pages }} 页
                            </span>
                        </li>
                        
                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">下一页</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}">末页</a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            {% endif %}
        {% else %}
            <div class="alert alert-info" role="alert">
                <i class="fas fa-info-circle mr-2"></i>
                {% if search_query %}
                    没有找到包含 "{{ search_query }}" 的文章。
                {% else %}
                    暂无文章，{% if user.is_authenticated %}<a href="{% url 'article:article_create' %}">创建第一篇文章</a>{% else %}<a href="{% url 'user:login' %}">登录</a>后创建文章{% endif %}。
                {% endif %}
            </div>
        {% endif %}
    </div>
    
    <div class="col-lg-4">
        <!-- 侧边栏 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">快速链接</h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    {% if user.is_authenticated %}
                        <li class="list-group-item">
                            <a href="{% url 'article:article_create' %}" class="btn btn-success btn-sm btn-block">
                                <i class="fas fa-pen mr-1"></i> 写新文章
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="{% url 'user:profile' %}" class="btn btn-info btn-sm btn-block">
                                <i class="fas fa-user mr-1"></i> 个人中心
                            </a>
                        </li>
                    {% else %}
                        <li class="list-group-item">
                            <a href="{% url 'user:login' %}" class="btn btn-primary btn-sm btn-block">
                                <i class="fas fa-sign-in-alt mr-1"></i> 登录
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="{% url 'user:register' %}" class="btn btn-warning btn-sm btn-block">
                                <i class="fas fa-user-plus mr-1"></i> 注册
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">网站信息</h5>
            </div>
            <div class="card-body">
                <p class="card-text">欢迎来到校园博客，这里是分享知识和想法的地方。</p>
                <a href="{% url 'about' %}" class="btn btn-outline-primary btn-sm">了解更多</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}